<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd" >
<sqlMap namespace="mypage">
	<select id="select_pwd" parameterClass="String" resultClass="String">
		select pass from member where id=#id#
	</select>

	<select id="modify_form" parameterClass="String" resultClass="com.encore.vo.Member">
		select id, pass, name, birth, email, phone  from member where id=#id#
	</select>
	
	<update id="modify" parameterClass="com.encore.vo.Member">
		update member set pass=#pass#, name=#name#, email=#email#, phone=#phone# 
		where id=#id# 
	</update>
	
	<insert id="assign_seller" parameterClass="java.util.Map">
		insert into sell_assign (id, account_num, sa_time)values(#id#, #account_num#, to_char(sysdate,'yyyy-mm-dd'))
	</insert>
	
	<delete id="drop_member" parameterClass="java.util.Map">
		delete from member where id=#id# and name=#name# and pass=#pass#
	</delete>
	
	<!--  페이지 처리 및 구매 리스트 관련   -->
	
	
	<select id="select_list" parameterClass="String" resultClass="HashMap">
		select to_char(bp_time, 'yyyy-mm-dd') bp_time, sp_category, sp_title, id, sp_count 
		from sell_post sp, buy_post bp 
		where sp.sp_no = bp.sp_no and bp.bp_id=#id#
	</select>
	
	<select id="count_buylist" parameterClass="String" resultClass="int">
		select count(*) 
		from sell_post sp, buy_post bp
		where sp.sp_no = bp.sp_no and bp.bp_id=#id#
	</select>
	
	<select id="select_page" resultClass="HashMap" parameterClass="java.util.Map">
	<![CDATA[
		select to_char(bp_time, 'yyyy-mm-dd') bp_time, sp_category, sp_title, id, sp_count
		from (select bp_time, sp_category, sp_title, id, sp_count, rownum rn 
				from (select bp_time, sp_category, sp_title, id, sp_count 
					  from sell_post sp, buy_post bp
					  where sp.sp_no = bp.sp_no and bp.bp_id=#id#
					  order by bp_time desc)
			  )
		where rn >= #start# and rn <= #end#
	]]>
	</select>
	
		<!-- 구매 전체 페이지 수 조회 -->
	<select id="select_totalpage" parameterClass="Map" resultClass="int">
		select ceil((select count(*) from sell_post sp, buy_post bp where sp.sp_no = bp.sp_no and bp.bp_id=#id#)/#pagecount#) 
		from dual
	</select>
</sqlMap>
